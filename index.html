<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Anagram Rush</title>
  <style>
    :root{--bg:#0b1020;--bg2:#0e1530;--card:#101735;--ink:#eef1ff;--muted:#a7afd6;--accent:#80a8ff;--accent2:#b5c8ff;--good:#34d399;--bad:#f87171;--ring:#3651a7}
    *{box-sizing:border-box}
    html,body{height:100%}
    body{margin:0;font-family:ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto,Inter,Helvetica,Arial;color:var(--ink);background:radial-gradient(1200px 700px at 10% 0%,#0e1a48 0%,transparent 60%),radial-gradient(900px 600px at 90% 100%,#0c1a3d 0%,transparent 65%),linear-gradient(180deg,var(--bg),var(--bg2));display:grid;place-items:center;padding:12px}
    .wrap{width:min(980px,96vw)}
    .card{background:linear-gradient(180deg,rgba(255,255,255,.02),rgba(255,255,255,0)),var(--card);border:1px solid rgba(132,151,255,.25);border-radius:22px;box-shadow:0 20px 60px rgba(0,0,0,.45),inset 0 0 0 1px rgba(255,255,255,.03);overflow:hidden}
    header{padding:12px 16px;border-bottom:1px solid rgba(132,151,255,.2);display:flex;align-items:center;justify-content:space-between;gap:8px;flex-wrap:nowrap}
    header h1{margin:0;font-size:16px;letter-spacing:.3px;white-space:nowrap}
    .pill{font-size:12px;color:var(--muted);padding:4px 8px;border:1px solid rgba(132,151,255,.25);border-radius:999px;white-space:nowrap}
    .progress{height:8px;background:rgba(255,255,255,.06);border-radius:999px;overflow:hidden;position:relative;margin:0 16px}
    .progress-bar{height:100%;width:0%;background:linear-gradient(90deg,var(--accent),var(--accent2));transition:width .4s ease}
    main{padding:16px}
    .stats{display:flex;gap:12px;flex-wrap:wrap;color:var(--muted);justify-content:center}
    .kpi{background:rgba(10,16,46,.75);border:1px solid rgba(132,151,255,.25);border-radius:12px;padding:8px 10px}
    .kpi strong{color:var(--ink)}
    .grid{display:flex;flex-wrap:nowrap;gap:6px;justify-content:center;margin:12px 0;overflow:visible;transform-origin:center}
    .tile{background:rgba(10,16,46,.9);border:1px solid rgba(132,151,255,.25);border-radius:10px;padding:10px 12px;text-align:center;font-weight:800;font-size:20px;letter-spacing:1px;box-shadow:0 6px 18px rgba(0,0,0,.25);min-width:28px}
    .controls{display:flex;gap:8px;margin:12px 0;flex-wrap:wrap;justify-content:center}
    button{background:var(--accent);color:#0b1020;border:none;padding:10px 14px;border-radius:12px;font-weight:700;cursor:pointer;transition:filter .2s ease,transform .06s ease}
    button:hover{filter:brightness(1.1)}
    button:active{transform:translateY(1px)}
    button.secondary{background:transparent;color:var(--ink);border:1px solid rgba(132,151,255,.35)}
    input[type=text]{width:100%;max-width:320px;padding:12px;border-radius:12px;border:1px solid rgba(132,151,255,.35);background:rgba(10,16,46,.7);color:var(--ink);font-size:16px;outline:none}
    input[type=text]:focus{box-shadow:0 0 0 4px rgba(128,168,255,.2);border-color:var(--ring)}
    .hint{color:var(--muted);font-size:14px}
    .footer{padding:12px 16px;border-top:1px solid rgba(132,151,255,.2);color:var(--muted);display:flex;justify-content:space-between;gap:8px;flex-wrap:wrap}
    table{width:100%;border-collapse:collapse;margin-top:10px}
    th,td{padding:8px;border-bottom:1px solid rgba(132,151,255,.2);text-align:left;font-size:13px}
    .sr{position:absolute;left:-9999px}
    .center{display:grid;place-items:center;text-align:center}
    .nameEntry{display:flex;gap:8px;align-items:center;flex-wrap:wrap;justify-content:center}
    [hidden]{display:none !important}
    @media (max-width: 480px){
      header h1{font-size:14px}
      .pill{font-size:10px;padding:4px 8px}
      .tile{min-width:26px;padding:6px 8px;font-size:16px;letter-spacing:.5px}
    }
  </style>
</head>
<body>
  <div class="wrap">
    <div class="card" id="app">
      <header>
        <h1>Anagram Rush</h1>
        <div class="pill">Private game ¬∑ 1995 Broadway</div>
      </header>
      <div class="progress"><div class="progress-bar" id="progressBar"></div></div>
      <main>
        <section id="setup">
          <h2 style="margin:0 0 6px">Ready?</h2>
          <p class="hint">Theme: NYC neighborhoods + Real Estate.</p>
          <div class="controls"><button id="startBtn">‚ñ∂ Start Game</button></div>
        </section>

        <section id="play" hidden>
          <div class="stats">
            <div class="kpi">Round <strong><span id="roundNow">1</span>/<span id="roundTotal">30</span></strong></div>
            <div class="kpi">Time <strong><span id="time">0.0</span>s</strong></div>
            <div class="kpi">Streak <strong><span id="streak">0</span></strong></div>
            <div class="kpi">Score <strong><span id="score">0</span></strong></div>
          </div>
          <div class="grid" id="grid" aria-live="polite"></div>
          <form id="guessForm" autocomplete="off" class="center">
            <label class="sr" for="guess">Your guess</label>
            <input id="guess" type="text" placeholder="Type the unscrambled word (no spaces)‚Ä¶" required />
            <div class="controls">
              <button type="submit">Submit</button>
              <button type="button" class="secondary" id="reshuffleBtn">Reshuffle</button>
              <button type="button" class="secondary" id="skipBtn">Skip</button>
            </div>
          </form>
          <div id="feedback" class="hint center"></div>
        </section>

        <section id="finish" hidden class="center">
          <div>
            <h2>üèÅ Game Over</h2>
            <p class="hint">Great run! Save your score to the leaderboard.</p>
            <div class="kpi">Final Score: <strong id="finalScore">0</strong></div>
            <div style="margin-top:12px" class="nameEntry">
              <input id="playerName" type="text" placeholder="Display name" maxlength="24" />
              <button id="saveScoreBtn">Save Score</button>
            </div>
            <p id="saveStatus" class="hint"></p>
            <div style="margin-top:16px;display:flex;gap:8px;justify-content:center;flex-wrap:wrap">
              <button id="playAgainBtn">Play Again</button>
              <button class="secondary" id="copyLinkBtn">Copy Share Link</button>
            </div>

            <h3 style="margin-top:20px">üèÜ Leaderboard</h3>
            <table id="board">
              <thead><tr><th>#</th><th>Name</th><th>Score</th><th>Time(s)</th><th>Date</th></tr></thead>
              <tbody></tbody>
            </table>
          </div>
        </section>
      </main>
      <div class="footer small">
        <span>Made for you ‚Äî link-only play.</span>
        <div><input type="checkbox" id="sounds" checked /> <label for="sounds">Sound FX</label></div>
      </div>
    </div>
  </div>

  <audio id="bgMusic" src="sounds/bg-music.mp3" loop preload="auto"></audio>

  <script>
    const FORM_ACTION = "https://docs.google.com/forms/d/e/1FAIpQLScpglp7w18EMoxlh8ynEj82G63jn7fZsvUgwTdMJKqt8CCBsQ/formResponse";
    const ENTRY_IDS = {name:"entry.1172479628",score:"entry.1803995992",totalTime:"entry.1884286962",seed:"entry.914252467",date:"entry.1001084897"};

    const WORDS = [
      "BROOKLYN","BRONX","QUEENS","MANHATTAN","HARLEM","SOHO","TRIBECA","CHELSEA","ASTORIA","DUMBO",
      "LEASE","TENANT","BROKER","ESCROW","MORTGAGE","TITLE","CLOSING","DEED","LIEN","COOP","LOFT","DUPLEX","CONDO","RENTAL","ZONING","LOT","BLOCK","PARCEL","AGENT","OFFER","LISTING",
      "APPRAISAL","EQUITY","LIABILITY","ASSET","CAPRATE","REALTOR","MLS","SUBLET","EASEMENT","VARIANCE","AMENITY","REFINANCE","FORECLOSURE","INVESTOR","PORTFOLIO","CASHFLOW","CAPITAL","RENOVATION","PENTHOUSE","MULTIFAMILY","DEVELOPER","ASSESSMENT","VACANCY","UNDERWRITING","INTEREST","PRINCIPAL","LIQUIDITY","AMORTIZE","COMMISSION"
    ];

    let wordQueue=[];
    function shuffleArray(a){for(let i=a.length-1;i>0;i--){const j=Math.floor(Math.random()*(i+1));[a[i],a[j]]=[a[j],a[i]];}return a;}
    function buildQueue(){wordQueue = shuffleArray(WORDS.slice()).slice(0,30);}

    let currentWord="",round=0,score=0,streak=0,totalTime=0,startTime,timerInterval;
    const startBtn=document.getElementById("startBtn");
    const setup=document.getElementById("setup"),play=document.getElementById("play"),finish=document.getElementById("finish");
    const grid=document.getElementById("grid"),guessForm=document.getElementById("guessForm"),guessInput=document.getElementById("guess");
    const feedback=document.getElementById("feedback"),roundNow=document.getElementById("roundNow"),roundTotal=document.getElementById("roundTotal");
    const scoreEl=document.getElementById("score"),streakEl=document.getElementById("streak"),timeEl=document.getElementById("time");
    const progressBar=document.getElementById("progressBar"),finalScore=document.getElementById("finalScore");
    const playerName=document.getElementById("playerName"),saveScoreBtn=document.getElementById("saveScoreBtn"),saveStatus=document.getElementById("saveStatus");
    const board=document.getElementById("board").querySelector("tbody");roundTotal.textContent=30;
    const sndToggle=document.getElementById("sounds");
    const bgMusic=document.getElementById("bgMusic");

    function shuffleWord(w){return w.split('').sort(()=>Math.random()-.5).join('');}
    function renderWord(word){grid.innerHTML="";shuffleWord(word).split('').forEach(l=>{const d=document.createElement("div");d.className="tile";d.textContent=l;grid.appendChild(d);});fitLetters();}
    function fitLetters(){
      const tiles=[...grid.children]; if(!tiles.length) return;
      grid.style.transform='scale(1)'; grid.style.transformOrigin='center';
      const gap=parseFloat(getComputedStyle(grid).gap)||6;
      const total=tiles.reduce((a,el)=>a+el.getBoundingClientRect().width,0)+Math.max(0,tiles.length-1)*gap;
      const max=grid.parentElement.getBoundingClientRect().width-12;
      const sc=Math.min(1,max/Math.max(1,total)); grid.style.transform=`scale(${sc})`;
    }
    window.addEventListener('resize', fitLetters); window.addEventListener('orientationchange',()=>setTimeout(fitLetters,100));

    function startTimer(){clearInterval(timerInterval);startTime=Date.now();timerInterval=setInterval(()=>{timeEl.textContent=((Date.now()-startTime)/1000).toFixed(1);},100);}
    function stopTimer(){clearInterval(timerInterval);const s=(Date.now()-startTime)/1000;totalTime+=s;return s;}
    function nextRound(){if(round>=30){endGame();return;}round++;roundNow.textContent=round;currentWord=wordQueue[round-1];renderWord(currentWord);startTimer();feedback.textContent="";guessInput.value="";guessInput.focus({preventScroll:true});}
    function endGame(){play.hidden=true;finish.hidden=false;finalScore.textContent=score;playGameOver();resumeMusic();}

    function startGame(){setup.hidden=true;play.hidden=false;round=0;score=0;streak=0;totalTime=0;progressBar.style.width='0%';buildQueue();nextRound();}

    startBtn.addEventListener("click",()=>{pauseMusic();startGame();});

    guessForm.addEventListener("submit",(e)=>{
      e.preventDefault();
      const g=guessInput.value.trim().toUpperCase();
      if(!g) return;
      if(g===currentWord){
        const secs=stopTimer();
        const pts=Math.max(50,1000-Math.floor(secs*10)+50*streak);
        score+=pts;streak++;
        scoreEl.textContent=score;streakEl.textContent=streak;
        progressBar.style.width=((round/30)*100)+"%";
        playCorrect(); nextRound();
      } else { feedback.textContent="Incorrect ¬∑ Try again"; playWrong(); }
    });

    document.getElementById("reshuffleBtn").addEventListener("click",()=>{ renderWord(currentWord); playClick(); });
    document.getElementById("skipBtn").addEventListener("click",()=>{ streak=0;streakEl.textContent=streak; stopTimer(); progressBar.style.width=((round/30)*100)+"%"; nextRound(); playClick(); });

    saveScoreBtn.addEventListener("click",()=>{
      const name=playerName.value.trim()||"Anonymous";
      const row=document.createElement("tr");
      row.innerHTML=`<td></td><td>${name}</td><td>${score}</td><td>${totalTime.toFixed(1)}</td><td>${new Date().toLocaleDateString()}</td>`;
      board.appendChild(row); [...board.querySelectorAll("tr")].forEach((r,i)=>r.firstChild.textContent=i+1);
      saveStatus.textContent="Saved locally.";
      const formData=new FormData();
      formData.append(ENTRY_IDS.name,name);
      formData.append(ENTRY_IDS.score,score);
      formData.append(ENTRY_IDS.totalTime,totalTime.toFixed(1));
      formData.append(ENTRY_IDS.seed,Math.random().toString(36).slice(2,8));
      formData.append(ENTRY_IDS.date,new Date().toISOString());
      fetch(FORM_ACTION,{method:"POST",mode:"no-cors",body:formData});
      playClick();
    });

    document.getElementById("playAgainBtn").addEventListener("click",()=>{finish.hidden=true;setup.hidden=false;resumeMusic();playClick();});
    document.getElementById("copyLinkBtn").addEventListener("click",()=>{navigator.clipboard.writeText(window.location.href);saveStatus.textContent="Link copied!";playClick();});

    // ---- File-based SFX from /sounds ----
    const sClick=new Audio("sounds/click.mp3");
    const sCorrect=new Audio("sounds/correct.mp3");
    const sWrong=new Audio("sounds/wrong.mp3");
    const sGameOver=new Audio("sounds/gameover.mp3");
    [sClick,sCorrect,sWrong,sGameOver].forEach(a=>{a.preload="auto"; a.volume=0.5; a.addEventListener("error",()=>console.warn("SFX not found:",a.src));});
    function playFile(a){ if(!sndToggle.checked) return; try{ a.currentTime=0; a.play(); }catch(e){} }
    function playClick(){ playFile(sClick); }
    function playCorrect(){ playFile(sCorrect); }
    function playWrong(){ playFile(sWrong); }
    function playGameOver(){ playFile(sGameOver); }

    // ---- Background music behavior ----
    function resumeMusic(){ if(sndToggle.checked){ bgMusic.currentTime=0; bgMusic.play().catch(()=>{}); } }
    function pauseMusic(){ try{ bgMusic.pause(); bgMusic.currentTime=0; }catch(e){} }
    document.addEventListener("pointerdown",function once(){ if(play.hidden && sndToggle.checked){ bgMusic.play().catch(()=>{});} document.removeEventListener("pointerdown",once);},{once:true,passive:true});
    sndToggle.addEventListener("change",(e)=>{ if(e.target.checked){ if(play.hidden){ resumeMusic(); } } else { try{ bgMusic.pause(); }catch(e){} } });

  </script>
</body>
</html>
